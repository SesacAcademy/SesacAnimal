# 📝 프로젝트 소개

![image](https://github.com/SesacAcademy/SesacAnimal/assets/55624470/37b816ce-9cb4-4934-866d-9782e64e9ea7)


<br/>

> 매년 유기견들이 늘어남에 따라 많은 유기견들에게 보호와 돌봄이 필요하지만 자원이 부족한 상황입니다.
>
> 새싹 애니멀은 이러한 상황을 개선하고 유기견에게 더 나은 미래를 제공하기 위해 유기견 입양/임보 서비스를 제공합니다. <br/>
> <br/>
> 개발 인원 : 4명 (박성수, 류명한, 이경진, 손승범) <br/>
> 개발 기간 : 2023.11.01 ~ 2023.11.17 



### Members
<table>
  <tr>
  	<td align="center">
      <a href="https://github.com/akgkfk3">
        <img
          src="https://avatars.githubusercontent.com/u/55624470?s=400&u=ce4242f40204eaf9a56687b9a2e510e3e805e505&v=4"
          width="100px;"
        /><br />박성수(BE)</a><br />
		팀장
    </td>
	<td align="center">
      <a href="https://github.com/devsince2021">
	<img
          src="https://avatars.githubusercontent.com/u/77978026?v=4"    
          width="100px;" 
        /><br />류명한(BE)</a><br />
		팀원
    </td>
    <td align="center">
      <a href="https://github.com/dev-lkj">
        <img
          src="https://avatars.githubusercontent.com/u/96426410?v=4"
          width="100px;"
        /><br />이경진(BE)</a><br />
	    	팀원
    </td>
    <td align="center">
      <a href="https://github.com/sonnbeom">
        <img
          src="https://avatars.githubusercontent.com/u/127067296?v=4"
          width="100px;"
        /><br />손승범(BE)</a><br />
	    	팀원
    </td>
  </tr>
</table>

<br/>

## 💁‍♂️ Wiki

- 📅 [개발 일정](https://github.com/SesacAcademy/SesacAnimal/wiki/%F0%9F%93%85-%EA%B0%9C%EB%B0%9C-%EC%9D%BC%EC%A0%95)
- 🌐 [실서버 링크 (배포완료)](https://toyproject.shucloud.site/)
- 📌 [Ground Rule](https://github.com/SesacAcademy/SesacAnimal/wiki/%F0%9F%93%8C-Ground-Rule)
- 🤙 [컨벤션](https://github.com/SesacAcademy/SesacAnimal/wiki/%F0%9F%A4%99-%EC%BB%A8%EB%B2%A4%EC%85%98)
- 📁 [디렉토리 구조](https://github.com/SesacAcademy/SesacAnimal/wiki/%F0%9F%93%81-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%A1%B0)
- 📜 [API 명세서](https://documenter.getpostman.com/view/28283234/2s9YRB2rty)
- 🖼️ [와이어프레임](https://www.figma.com/file/HCFnoJsXRjHzAwIavRGfh4/Sesac-Animal?type=design&node-id=28-2&mode=design)
- 📚 [다이어그램 (클래스, 시퀀스)](https://github.com/SesacAcademy/SesacAnimal/wiki/%F0%9F%93%9A-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8-(%ED%81%B4%EB%9E%98%EC%8A%A4,-%EC%8B%9C%ED%80%80%EC%8A%A4))

<br/>

## 🛠 사용 기술
<b>[Front-end]</b>
<br/>
<img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white"> 
<img src="https://img.shields.io/badge/css3-1572B6?style=for-the-badge&logo=css3&logoColor=white">
<img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
<br/>
<img src="https://img.shields.io/badge/BootStrap-7952B3?style=for-the-badge&logo=BootStrap&logoColor=white">
<img src="https://img.shields.io/badge/jQuery-0769AD?style=for-the-badge&logo=jQuery&logoColor=white">
<img src="https://img.shields.io/badge/fontawesome-339AF0?style=for-the-badge&logo=fontawesome&logoColor=white">


<b>[Back-end]</b>
<br/>
<img src="https://img.shields.io/badge/OpenJDK 17-999999?style=for-the-badge&logo=OpenJDK&logoColor=white">
<img src="https://img.shields.io/badge/mysql 8.0-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
<img src="https://img.shields.io/badge/Redis 5.0.3-DC382D?style=for-the-badge&logo=redis&logoColor=white">
<br/>
<img src="https://img.shields.io/badge/spring 5.3-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
<img src="https://img.shields.io/badge/springboot 2.7-6DB33F?style=for-the-badge&logo=springBoot&logoColor=white">
<img src="https://img.shields.io/badge/spring security 5.7-6DB33F?style=for-the-badge&logo=springsecurity&logoColor=white">
<br/>
<img src="https://img.shields.io/badge/Hibernate 5.1-59666C?style=for-the-badge&logo=hibernate&logoColor=white">
<img src="https://img.shields.io/badge/spring data jpa 2.7-A81C7D?style=for-the-badge">
<img src="https://img.shields.io/badge/QueryDSL 5.0-A81C7D?style=for-the-badge">


<b>[Tool & Environment]</b>
<br/>
<img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/gradle-02303A?style=for-the-badge&logo=gradle&logoColor=white">
<img src="https://img.shields.io/badge/linux-FCC624?style=for-the-badge&logo=linux&logoColor=black">
<img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=black">
<img src="https://img.shields.io/badge/postman-FF6C37?style=for-the-badge&logo=postman&logoColor=white">
<br/>
<br/>

## 🔨 시스템 아키텍처

![image](https://github.com/SesacAcademy/SesacAnimal/assets/55624470/1ffa4dcf-22c2-4451-a8e0-f7458b4f53b1)



<br/>

## 🗒️ ERD 설계

- [ERD 링크]()

![image](https://github.com/SesacAcademy/SesacAnimal/assets/55624470/3574c649-eea8-4932-83ad-f772b691c36c)


<br/>

## 💡 주요 기능

#### 👩‍👧 회원 (박성수)

- 이메일 인증을 통한 회원가입 기능 📌 [[코드 1]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/service/MemberServiceImp.java#L58) [[코드 2]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/provider/MailAuthCodeProvider.java#L38)

- (JWT) 토큰 기반 방식의 로그인 기능 (Spring Security를 활용한 인증/인가) 📌 [[코드 1]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/controller/LoginController.java#L60) [[코드 2]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/filter/JwtExceptionFilter.java#L32) [[코드 3]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/filter/JwtAuthenticationFilter.java#L32) [[코드 4]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/provider/JwtTokenProvider.java#L58)

- 카카오 플랫폼을 이용한 소셜 로그인 기능 📌 [[코드 1]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/controller/LoginController.java#L87)
  
- 사용자 정보를 통한 아이디 찾기, SMS 문자 인증을 통한 비밀번호 찾기 기능 📌 [[코드 1]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/controller/MemberController.java#L116) [[코드 2]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/controller/MemberController.java#L137) [[코드 3]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/member/service/MemberServiceImp.java#L134) [[코드 4]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/provider/SmsAuthCodeProvider.java#L37)

#### 🚨 실종 (류명한)

#### 🐈 입양/임보 (이경진)

#### ✏️ 입양 후기 (손승범)


<br/>

## 🌟 트러블 슈팅

<details>
<summary>박성수</summary>
<hr/>

- 📌 [[코드 확인]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/filter/JwtExceptionFilter.java#L87)
<table>
  	<tr>
  		<td align="center">
      			문제 상황
    		</td>
		<td>
      			JWT 리프레시 토큰 만료 시, 토큰이 담긴 쿠키가 삭제되지 않음
    		</td>
  	</tr>
	<tr>
		<td align="center">
			원인
		</td>
		<td>
   			HttpServletRequest 객체에 담긴 쿠키는 단순히 Key-Value 값만을 가지고 있기 Cookie 객체에 setMaxAge() 외에 추가적인 설정 필요
    		</td>
	</tr>
 	<tr>
     		<td align="center">
			해결
		</td>
		<td>
      			만료 날짜 (setMaxage), 경로 (setPath), 값 (setValue)을 지정하여 쿠키를 삭제
    		</td>
      	</tr>
</table>


<pre>
<code>[Before]
private void removeTokenInCookie(HttpServletRequest request, HttpServletResponse response) {
	// request 객체에서 JWT Token이 담긴 Cookie를 List 형태로 가져 온다.
	List<Cookie> cookielist = Arrays.stream(request.getCookies())
			.filter(cookie -> {
				return cookie.getName().equals(JWT_ACCESS_TOKEN) || cookie.getName().equals(JWT_REFRESH_TOKEN);})
			.toList();

	// cookie의 타임 아웃을 0으로 만들고 다시 response 객체에 저장한다.
	cookielist.forEach(cookie -> {
		cookie.setMaxAge(0);
		response.addCookie(cookie);
	});
}
</code>
</pre>

<pre>
<code>[After]
private void removeTokenInCookie(HttpServletRequest request, HttpServletResponse response) {
	// request 객체에서 JWT Token이 담긴 Cookie를 List 형태로 가져 온다.
	List<Cookie> cookielist = Arrays.stream(request.getCookies())
			.filter(cookie -> {
				return cookie.getName().equals(JWT_ACCESS_TOKEN) || cookie.getName().equals(JWT_REFRESH_TOKEN);})
			.toList();

	// cookie의 타임 아웃을 0으로 만들고 다시 response 객체에 저장한다.
	cookielist.forEach(cookie -> {
		cookie.setMaxAge(0);
		cookie.setPath("/");
            	cookie.setValue(null);
		response.addCookie(cookie);
	});
}
</code>
</pre>

<hr/>
<table>
  	<tr>
  		<td align="center">
      			문제 상황  
    		</td>
		<td>
      			Controller에서 Redirect 시, 브라우저에서 Redirect된 주소로 이동하지 못함
    		</td>
  	</tr>
	<tr>
		<td align="center">
			원인
		</td>
		<td>
   			HTTP 요청은 로드밸런서를 통해 Tomcat으로 전달되고 외부 통신은 HTTPS, 내부 통신은 HTTP를 이용하기 때문에 Controller에서 Redirect 시, Location 헤더에는 "http://~~" 값이 들어가기 때문
    		</td>
	</tr>
 	<tr>
     		<td align="center">
			해결
		</td>
		<td>
      			내부 통신도 Self-Signed Key를 생성하여 HTTPS 통신을 해도 되지만 HTTP(80)으로 요청 시, HTTPS(443)으로 Redirect 하도록 HAProxy 설정을 추가
    		</td>
      	</tr>
</table>


<pre>
<code>[Before]
#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
frontend main
    bind *:443 ssl crt /etc/haproxy/server.pem
    log 127.0.0.1:514 local1
    default_backend             app

#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------
backend app
    balance     roundrobin
    server  was01 192.168.0.105:8001 check
    server  was02 192.168.0.105:8002 check
    server  was03 192.168.0.105:8003 check
</code>
</pre>

<pre>
<code>[After]
#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
frontend main
    bind *:80
    bind *:443 ssl crt /etc/haproxy/server.pem
    http-request redirect scheme https unless { ssl_fc }
    log 127.0.0.1:514 local1
    default_backend             app

#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------
backend app
    balance     roundrobin
    server  was01 192.168.0.105:8001 check
    server  was02 192.168.0.105:8002 check
    server  was03 192.168.0.105:8003 check
</code>
</pre>

<hr/>
 
</details>

<details>
<summary>류명한</summary>

<table>
  	<tr>
  		<td align="center">
      			문제 상황  
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			원인
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
 	<tr>
     		<td align="center">
			해결
		</td>
		<td>
      			작성 예정
    		</td>
      	</tr>
</table>
</details>

<details>
<summary>이경진</summary>

<table>
  	<tr>
  		<td align="center">
      			문제 상황  
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			원인
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
 	<tr>
     		<td align="center">
			해결
		</td>
		<td>
      			작성 예정
    		</td>
      	</tr>
</table>
</details>

<details>
<summary>손승범</summary>

<table>
  	<tr>
  		<td align="center">
      			문제 상황  
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			원인
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
 	<tr>
     		<td align="center">
			해결
		</td>
		<td>
      			작성 예정
    		</td>
      	</tr>
</table>
</details>


<br/>

## 👩‍💻 리팩토링

<details>
<summary>박성수</summary>

<hr/>

- 📌 [[코드 확인]](https://github.com/SesacAcademy/SesacAnimal/blob/dev/src/main/java/com/project/animal/global/common/resolver/MemberDtoArgumentResolver.java#L37)

<table>
  	<tr>
  		<td align="center">
      			Before
    		</td>
		<td>
      			도메인별 Controller에서 사용자 정보 (MemberDto)를 얻기 위해, JWT 토큰에 담긴 클레임을 직접 파싱
    		</td>
  	</tr>
	<tr>
		<td align="center">
			After
		</td>
		<td>
   			MemberDto에 맞는 ArgumentResolver를 추가하여 Controller에서 직접 파싱하지 않도록 변경 (중복 코드 제거)
    		</td>
	</tr>
</table>

<pre>
@Slf4j
@Component
@RequiredArgsConstructor
public class MemberDtoArgumentResolver implements HandlerMethodArgumentResolver {

    private final JwtTokenProvider jwtTokenProvider;

    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        boolean hasMemberAnnotation = parameter.hasParameterAnnotation(Member.class);
        boolean hasMemberType = MemberDto.class.isAssignableFrom(parameter.getParameterType());

        return hasMemberAnnotation && hasMemberType;
    }

    @Override
    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {

        HttpServletRequest request = (HttpServletRequest) webRequest.getNativeRequest();

        String token = jwtTokenProvider.resolveToken(request, JWT_ACCESS_TOKEN);

        // 기존 쿠키에 JWT Access 토큰이 없는 경우, Request 영역에 저장해둔 newAccessToken을 사용
        if (token == null && request.getAttribute(JWT_ACCESS_TOKEN) != null)
            token = (String) request.getAttribute(JWT_ACCESS_TOKEN);

        // 기존 쿠키에 JWT Access 토큰이 있는 경우, JWT를 파싱하여 MemberDto 객체로 리턴
        if (token != null)
            return jwtTokenProvider.parseToken(token);

        // 없으면 null 값 리턴
        return null;
    }
}
</code>
</pre>

<hr/>

</details>

<details>
<summary>류명한</summary>

<table>
  	<tr>
  		<td align="center">
      			Before
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			After
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
</table>
</details>

<details>
<summary>이경진</summary>

<table>
  	<tr>
  		<td align="center">
      			Before
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			After
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
</table>
</details>

<details>
<summary>손승범</summary>

<table>
  	<tr>
  		<td align="center">
      			Before
    		</td>
		<td>
      			작성 예정
    		</td>
  	</tr>
	<tr>
		<td align="center">
			After
		</td>
		<td>
   			작성 예정
    		</td>
	</tr>
</table>
</details>


<br/>

## 📋 프로젝트를 진행하며 느낀 점

<details>
<summary>박성수</summary>

- 작성 예정

- 작성 예정

</details>

<details>
<summary>류명한</summary>

- 작성 예정

- 작성 예정

</details>

<details>
<summary>이경진</summary>

- 작성 예정

- 작성 예정

</details>

<details>
<summary>손승범</summary>

- 작성 예정

- 작성 예정

</details>






